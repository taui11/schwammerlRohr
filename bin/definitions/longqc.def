Bootstrap: docker
From: continuumio/miniconda3

%labels
    base_image miniconda3
    software LongQC
    version 1.2
    maintainer Yoshinori Fukasawa <yoshinori.fukasawa@kaust.edu.sa>

%post
    # Update and install basic dependencies
    apt-get clean all
    apt-get update
    apt-get upgrade -y
    apt-get install -y git build-essential libc6-dev zlib1g-dev
    apt-get clean
    apt-get purge -y

    # Clone LongQC repo and build minimap2-coverage
    git clone https://github.com/yfukasawa/LongQC.git /root/LongQC
    cd /root/LongQC/minimap2-coverage && make

    # Modify longQC.py for shebang and executable
    sed -i -e '1{s;^;#!/opt/conda/bin/python\n;}' /root/LongQC/longQC.py
    chmod +x /root/LongQC/longQC.py



    # Add conda channels and install dependencies
    conda config --add channels conda-forge
    conda config --add channels bioconda
    conda install -y python=3.9 numpy pandas>=0.24.0 scipy jinja2 h5py matplotlib>=2.1.2 scikit-learn

    # Accept Conda Terms of Service for required channels
    conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main
    conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r

    conda install -y -c bioconda edlib pysam python-edlib

%environment
    export PATH="/root/LongQC:$PATH"

%runscript
    exec longQC.py "$@"
