Bootstrap: docker
From: continuumio/miniconda3

%post
    # Update and install tools
    apt-get update && apt-get install -y wget bzip2

    # Set up conda channels
    conda config --add channels defaults
    conda config --add channels bioconda
    conda config --add channels conda-forge

    # Create new environment with Python 3.12 and install flye there
    conda create -y -n flye_env python=3.12 flye

    # Activate the environment by default
    echo "source activate flye_env" >> ~/.bashrc
    conda clean -afy
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    # Activate conda env and add binaries to PATH
    export PATH="/opt/conda/envs/flye_env/bin:$PATH"
    export CONDA_DEFAULT_ENV=flye_env

%runscript
    # Use Flye from the conda environment
    exec flye "$@"
