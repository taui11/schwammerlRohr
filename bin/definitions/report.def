Bootstrap: docker
From: rocker/r2u:24.04

%labels
    maintainer "you"
    purpose "mycoBinR reports (HTML rendering)"

%environment
    export LANG=C.UTF-8
    export LC_ALL=C.UTF-8

%post
    set -eu

    apt-get update
    apt-get install -y --no-install-recommends \
        pandoc git ca-certificates \
        libxml2-dev libcurl4-openssl-dev libssl-dev libgit2-dev
    rm -rf /var/lib/apt/lists/*

    # One call: disable bspm, set CRAN, install pak
    R --quiet --vanilla -e 'if (requireNamespace("bspm", quietly=TRUE)) bspm::disable();
                            options(bspm.enable=FALSE, repos=c(CRAN="https://cloud.r-project.org"));
                            install.packages("pak", repos="https://cloud.r-project.org")'

    # Everything via pak (no install.packages / BiocManager to avoid ABI mixing)
    R --quiet --vanilla -e 'pak::pak(c(
      "rmarkdown","knitr","dplyr","tidyr","tibble",
      "ggplot2","cowplot","jsonlite","stargazer","htmlTable","rjson","kableExtra",
      "taxonomizr","ggpubr","ggraph","mclust","ape","clue","igraph","reshape2","taxize"
    ), upgrade=FALSE)'

    R --quiet --vanilla -e 'pak::pak(c("bioc::Biostrings","bioc::Rsamtools"), upgrade=FALSE)'

    R --quiet --vanilla -e 'pak::pak(c(
      "GuillemSalazar/FastaUtils",   # GitHub (not on CRAN)
      "taui11/mycoBinR"
    ), upgrade=FALSE)'



%runscript
    exec /bin/bash -lc "$@"
